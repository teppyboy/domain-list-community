const fs = require('fs');
const path = require('path');

const OUT_DIR="./data/"

function processHosts(content) {
    let str = "# Generated by hosts-converter.js\n#\n";
    const lines = content.split("\n");
    lines.forEach((line) => {
        if (line.startsWith("0.0.0.0") || line.startsWith("127.0.0.1")) {
            line = line.split(" ")[1];
        }
        str += line + "\n";
    })
    return str;
}

function convertDir(dir) {
    console.log(`Reading ${dir}`);
    var files = fs.readdirSync(dir);
    files.forEach((file) => {
        const fullPath = path.join(dir, file);
        fs.readFile(fullPath, (err, data) => {
            const filePath = path.parse(file);
            if (filePath.ext === ".txt") {
                console.log(`Converting ${file}...`);
                const converted = processHosts(data.toString("utf-8"));
                const outPath = path.join(OUT_DIR, `category-${filePath.name.toLowerCase()}`);
                fs.writeFileSync(outPath, converted);
                console.log(`Converted to ${outPath}`);
            }
        })
    })
}

convertDir("./mobile-hosts")
